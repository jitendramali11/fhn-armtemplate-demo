name: FHN Infra Deployment - ARM Template

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:

  deploy:
    runs-on: ubuntu-20.04
    steps:
    
    - name: Login via Az module
      uses: azure/login@v1.1
      with:
        creds: ${{secrets.AZURE_CREDENTIALS}}
        enable-AzPSSession: true
    
    - name: Checkout Source Code
      uses: actions/checkout@v2
        
    - name: Run Azure PowerShell script DeployARMtoAzure.ps1
      uses: azure/powershell@v1
      with:
        inlineScript: |
          Set-AzContext -Subscription '6bb8f7ca-b738-4cbf-8234-bc849a0d3a89';
          $command = "./appname-dev/run-it.ps1";
          Invoke-Expression $command;
        azPSVersion: '4.1.0'
        #AzPS 4.1.0 is needed to set Tags on the Deployments; AzPS 4.1.0 needs Ubuntu-20.04
